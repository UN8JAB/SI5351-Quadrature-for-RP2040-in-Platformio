### Обзор
Библиотека **Si5351** для управления синтезатором частоты Si5351 на микроконтроллере RP2040 с использованием Arduino Framework в PlatformIO. Позволяет генерировать квадратурные сигналы в диапазоне частот от 3МГц до 40МГц (выше не проверял). Имеем два виртуальных VFO: VFO0 (CLK0 и CLK1 с настраиваемой фазой для квадратуры) и VFO1 (CLK2).

### Особенности
- Настройка и генерация частот от 3 МГц до 40 МГц.
- Поддержка квадратурных фазовых сдвигов (0°, 90°, 180°, 270°) для VFO0.
- Целочисленный режим делителей MultiSynth для чистого сигнала.
- Фиксированная мощность выхода 4 мА для всех выходных сигналов (можно перестроить на желаемое в самой библиотеке).
- Настраиваемая частота кварца (по умолчанию 25 МГц, можно указать точное значение).
- Простой интерфейс I2C для общения с чипом Si5351.
- Оптимизировано для RP2040 с Arduino Framework.

### Установка
1. **Склонируйте или скачайте библиотеку**:
   - Склонируйте репозиторий или скачайте файлы `si5351.h` и `si5351.cpp`.
   - Поместите их в папку `lib` вашего проекта PlatformIO.

2. **Добавьте зависимости**:
   - Убедитесь, что библиотека `Wire` включена в проект (она входит в Arduino Framework для RP2040 и уже включена в хэдере si5351.h).
   ```cpp
   #include <Wire.h>
   ```

3. **Подключите Si5351**:
   - Подключите Si5351 к RP2040 через I2C:
     - SDA к GPIO (по умолчанию, GPIO4).
     - SCL к GPIO (по умолчанию, GPIO5).
     - VCC к 3.3 В, GND к GND.
   - Убедитесь, что на линиях I2C есть подтягивающие резисторы (обычно 4.7 кОм, на фиолетовой плате они уже есть).

### Использование
1. **Подключите библиотеку**:
   ```cpp
   #include "si5351.h"
   ```

2. **Инициализируйте Si5351**:
   Создайте экземпляр с указанием частоты кварца (по умолчанию 25 МГц, или укажите измеренное значение для точности):
   ```cpp
   Si5351 vfo(25000000UL); // Частота кварца 25 МГц
   ```

3. **Настройте в `setup()`**:
   Инициализируйте чип в функции `setup()`:
   ```cpp
   void setup() {
       vfo.begin(); // Инициализация I2C и настройка Si5351
   }
   ```

4. **Настройте частоты и выходы**:
   Установите желаемую частоту для VFO и включите выход:
   ```cpp
    vfo.setFreq(0, 7040000); // Установить частоту 7.040 МГц для CLK0 и CLK1
    vfo.enable(0, true); // Включить выходы
    vfo.update(0); // Применить настройки
   ```

5. **Квадратурный выход** (опционально):
   Для приложений, требующих квадратурных сигналов (например, I/Q для SDR):
   ```cpp
   vfo.setFreq(0, 7040000); // Установить частоту 7.040 МГц для CLK0 и CLK1
   vfo.setPhase(0, PH090);  // 90 градусов фаза между CLK0 и CLK1
   vfo.enable(0, true); // Включить выходы
   vfo.update(0); // Применить настройки
   ```

### Пример
Этот пример устанавливает VFO0 на 7.074 МГц с фазовым сдвигом 90 градусов и VFO1 на 10 МГц.

```cpp
#include <Arduino.h>
#include "si5351.h"

Si5351 vfo(25000000UL); // Crystal is 25 MHz

void setup() {
    Serial.begin(57600);
    Serial.println("Serial started");

    // Initialization Si5351
    vfo.begin(); // Start VFO
    Serial.println("Si5351 begin");
    vfo.resetPLL();
    Serial.println("PLL Reset done");

    // VFO0 (quadrature for CLK0 and CLK1)
    vfo.setFreq(0, 7074000);
    vfo.setPhase(0, PH090);  // 90 deg between CLK0 CLK1
    vfo.enable(0, true);
    vfo.update(0);

    // VFO1 simple for CLK2
    vfo.setFreq(1, 10000000);
    vfo.enable(1, true);
    vfo.update(1);

    Serial.println("Si5351 initialized");
}

void loop() {
    // yours code here
}
```

### Справочник API

#### Конструктор
- `Si5351 vfo(25000000UL)`: Инициализация с указанием частоты кварца (по умолчанию 25 МГц).

#### Методы
- `vfo.begin()`: Инициализация I2C и базовая настройка Si5351 (VFO0 включен, VFO1 выключен).
- `vfo.resetPLL()`: Сброс PLLA и PLLB для применения новых настроек (может вызвать кратковременный щелчок).
- `vfo.enable(uint8_t vfoIdx, bool en)`: Включение или отключение VFO (0 для CLK0+CLK1, 1 для CLK2).
- `vfo.setPhase(uint8_t vfoIdx, uint8_t phase)`: Установка фазы для VFO0 (CLK1 относительно CLK0). Допустимые значения `phase`: `PH000` (0°), `PH090` (90°), `PH180` (180°), `PH270` (270°).
- `vfo.setFreq(uint8_t vfoIdx, uint32_t freqHz)`: Установка целевой частоты для VFO в Гц (от 8 кГц до 160 МГц).
- `vfo.update(uint8_t vfoIdx)`: Расчет и запись настроек регистров для указанного VFO.

### Примечания
- **Частота кварца**: Для максимальной точности измерьте частоту вашего кварца и передайте её в конструктор.
- **Диапазон частот**: Библиотека ориентирована на частоту VCO около 700 МГц для оптимальной производительности, с автоматическим выбором R-делителей (1, 32, 128) в зависимости от частоты.
- **Квадратурный выход**: Настройка фазы поддерживается только для VFO0 (CLK0 и CLK1). Для точного сдвига на 90 градусов используйте R=1 и целочисленный режим MultiSynth.
- **Мощность выхода**: Библиотека фиксирует мощность выхода на 4 мА для всех выходных сигналов (CLK0, CLK1, CLK2) для обеспечения стабильной работы.
- **PlatformIO**: Убедитесь, что RP2040 настроен для работы с Arduino Framework в `platformio.ini`.

### Лицензия
Библиотека распространяется под лицензией MIT.
The library is distributed under the MIT license.
